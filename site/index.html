<!DOCTYPE html>

<!-- Add a svg area, empty -->
<div id="scatter_area"></div>
<div class="info">
  <div id="lineplot_area"></div>
  <ul id="name_info">
    <li>
      <div class="info_line">
        <div class="info_title">
          Name :
        </div>
        <div class="info_value">
          Some name
        </div>
      </div>
    </li>
    <li>
      <div class="info_line">
        <div class="info_title">
          Gender :
        </div>
        <div class="info_value">
          Pansexual
        </div>
      </div>
    </li>
  </ul>
</div>
<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<script>
var name_info

// set the dimensions and margins of the graph
var margin = {top: 10, right: 40, bottom: 30, left: 30},
    width = 900 - margin.left - margin.right,
    height = 650 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svG = d3.select("#scatter_area")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

svG.append("rect")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("fill", "white");


svG
  .call(d3.zoom().on("zoom", function () {
     svG.attr("transform", d3.event.transform)
  }))

// Create data
d3.csv("info.csv", function(error, data) {
  console.log(data)
  name_info = data

  console.log(data.map(d => +d.x))

  // X scale and Axis
  var x = d3.scaleLinear()
      .domain([Math.min(...data.map(d => +d.x)), Math.max(...data.map(d => +d.x))])
      .range([0, width]);       // This is the corresponding value I want in Pixel
  svG
    .append('g')
    .attr("transform", "translate(0," + height + ")")
    // .call(d3.axisBottom(x));

  // X scale and Axis
  var y = d3.scaleLinear()
      .domain([d3.min(data.map(d => +d.y)), d3.max(data.map(d => +d.y))])         // This is the min and the max of the data: 0 to 100 if percentages
      .range([height, 0]);       // This is the corresponding value I want in Pixel
  // svG
  //   .append('g')
  //   .call(d3.axisLeft(y));

  var scale = d3.scaleLog()
     .domain([d3.min(data.map(d => +d.count)), d3.max(data.map(d => +d.count))])
     .range([2, 7]);


 // add the tooltip area to the webpage
 var tooltip = d3.select("body").append("div")
     .attr("class", "tooltip")
     .style("opacity", 0);

  // Add 3 dots for 0, 50 and 100%
  svG
    .selectAll("whatever")
    .data(data)
    .enter()
    .append("circle")
      .attr("class", "name")
      .attr("cx", function(d){ return x(d.x) })
      .attr("cy", function(d){ return y(d.y) })
      .attr("r", function(d){ return scale(d.count) })
      .style("fill", function(d) { return d.sexe == 0 ? '#FF6088' : '#3498db';})
      .on("mouseover", function(d) {
        tooltip.transition()
             .duration(200)
             .style("opacity", .9);
        tooltip.html(d.name + "<br/>" + d.idxmax
          + ": " + d.max)
             .style("left", (d3.event.layerX + 5) + "px")
             .style("top", (d3.event.layerY - 28) + "px");
        d3.select(this).classed("active", true )
        updateData(d.name_index, d.sexe_index)
      })
      .on("mouseout", function(d) {
        tooltip.transition()
         .duration(500)
         .style("opacity", 0);
        d3.select(this).classed("active", false )

      });
})


</script>

<script type="text/javascript" src="lineplot.js"> </script>

<style>
  .info {
    display: flex;
    flex-direction: row;
  }
  .name {
    stroke: black;
    stroke-width: 0.5;
  }
  .name.active {
    stroke: black;
    stroke-width: 1.5;
  }
  .info_line {
    display: flex;
    flex-direction: row;
  }
  .tooltip {
    position: absolute;
    background-color: #FFFFFF;
    padding: 10px;
    width: 300px;
    height: 28px;
    pointer-events: none;
  }
  .line {
    fill: none;
    stroke: steelblue;
    stroke-width: 1.5;
  }
</style>
